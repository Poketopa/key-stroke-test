<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TypingDNA í…ŒìŠ¤íŠ¸</title>
    <script src="https://www.typingdna.com/scripts/typingdna.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .user-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .text-area {
            width: 100%;
            height: 150px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            resize: none;
            margin-bottom: 20px;
        }
        .button {
            background: #2196F3;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        .button:hover {
            background: #1976D2;
        }
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .button.secondary {
            background: #FF9800;
        }
        .button.secondary:hover {
            background: #F57C00;
        }
        .button.success {
            background: #4CAF50;
        }
        .button.success:hover {
            background: #45a049;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .test-instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .pattern-count {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>TypingDNA ì‚¬ìš©ì êµ¬ë¶„ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="user-info" id="userInfo">
            <strong>í˜„ì¬ ì‚¬ìš©ì:</strong> <span id="currentUser">user123456</span>
        </div>

        <div class="test-instructions">
            <h4>í…ŒìŠ¤íŠ¸ ë°©ë²•:</h4>
            <ol>
                <li>ì‚¬ìš©ì Aë¡œ ë¡œê·¸ì¸í•˜ì—¬ íƒ€ì´í•‘ íŒ¨í„´ì„ ì €ì¥í•©ë‹ˆë‹¤</li>
                <li>ì‚¬ìš©ì Bë¡œ ë¡œê·¸ì¸í•˜ì—¬ íƒ€ì´í•‘ íŒ¨í„´ì„ ì €ì¥í•©ë‹ˆë‹¤</li>
                <li>ê° ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸í•˜ì—¬ íŒ¨í„´ ê²€ì¦ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤</li>
            </ol>
        </div>

        <div>
            <h3>íƒ€ì´í•‘ í…ŒìŠ¤íŠ¸</h3>
            <p>ì•„ë˜ í…ìŠ¤íŠ¸ë¥¼ íƒ€ì´í•‘í•´ì£¼ì„¸ìš”:</p>
            <textarea 
                id="typingArea" 
                class="text-area" 
                placeholder="ì—¬ê¸°ì— íƒ€ì´í•‘í•˜ì„¸ìš”..."
                onkeyup="onKeyUp(event)"
                onkeydown="onKeyDown(event)"
                oninput="onInput(event)"
                onfocus="onFocus()"
                onpaste="onPaste(event)"
                oncut="onCut(event)"
            ></textarea>
            <div class="pattern-count" id="patternCount"></div>
        </div>

        <div>
            <button class="button" onclick="savePattern()">íŒ¨í„´ ì €ì¥</button>
            <button class="button secondary" onclick="verifyPattern()">íŒ¨í„´ ê²€ì¦</button>
            <button class="button success" onclick="compareUsers()">ì‚¬ìš©ì ë¹„êµ</button>
            <button class="button" onclick="testConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
            <button class="button" onclick="simpleTest()">ê°„ë‹¨ í…ŒìŠ¤íŠ¸</button>
            <button class="button" onclick="testApiKey()">API í‚¤ í…ŒìŠ¤íŠ¸</button>
            <button class="button" onclick="minimalTest()">ìµœì†Œ í…ŒìŠ¤íŠ¸</button>
            <button class="button" onclick="checkUser()">ì‚¬ìš©ì í™•ì¸</button>
            <button class="button" onclick="clearText()">í…ìŠ¤íŠ¸ ì§€ìš°ê¸°</button>
            <button class="button" onclick="showRealTimePattern()">ì‹¤ì‹œê°„ íŒ¨í„´ í™•ì¸</button>
            <button class="button" onclick="startRecording()">ë…¹í™” ì‹œì‘</button>
            <button class="button secondary" onclick="clearPattern()">íŒ¨í„´ ì´ˆê¸°í™”</button>
            <button class="button success" onclick="verifyUser()" id="verifyButton" style="display: none;">ìœ ì € ê²€ì¦í•˜ê¸°</button>
        </div>

        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script>
        let userId = "user123456";
        let tdna = new TypingDNA();
        let isRecording = false;
        let keyCount = 0;
        
        // ê³ ì •ëœ user_id ê°’
        const USER_A = "B6E3DC0FF5A19566DCA703F84A2C09BDD5DD22891E09B9FB3FC436C5BE9ECF9C";
        const USER_B = "36D2620917D391C0700B144223FFAC4D7993AD2C8CB90BC072A37BB8372B5A6A";
        
        // ê¸°ë³¸ user_id ìƒì„± (ê³ ì •ê°’ ì‚¬ìš©)
        function getUserA() {
            return USER_A;
        }
        
        function getUserB() {
            return USER_B;
        }

        function setUserId(id) {
            userId = id;
            document.getElementById('currentUser').textContent = userId;
            document.getElementById('userInfo').style.backgroundColor = 
                userId === 'user123456' ? '#e8f5e8' : '#fff3e0';
            clearText();
            
            // verify ëª¨ë“œì¸ ê²½ìš° ìœ ì € ê²€ì¦ ë²„íŠ¼ í‘œì‹œ
            if (id === 'verify') {
                document.getElementById('verifyButton').style.display = 'block';
                document.getElementById('currentUser').textContent = 'ìœ ì € ê²€ì¦ ëª¨ë“œ';
                document.getElementById('userInfo').style.backgroundColor = '#fff3cd';
            } else {
                document.getElementById('verifyButton').style.display = 'none';
            }
            
            // ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸
            console.log('User ID set to:', userId);
            if (typeof Android !== 'undefined') {
                Android.logError(`User ID set to: ${userId}`);
            }
        }

        function onKeyDown(event) {
            if (!isRecording) {
                isRecording = true;
                tdna.start();
            }
            tdna.addKeyDown(event);
            keyCount++;
            updatePatternCount();
            
            console.log('JavaScript Key Down:', event.keyCode, 'Key:', event.key);
            if (typeof Android !== 'undefined') {
                Android.logError(`JavaScript Key Down: ${event.keyCode} (${event.key})`);
                Android.logKeyEvent(event.keyCode, 'DOWN');
            }
        }

        function onKeyUp(event) {
            tdna.addKeyUp(event);
            console.log('JavaScript Key Up:', event.keyCode, 'Key:', event.key);
            if (typeof Android !== 'undefined') {
                Android.logError(`JavaScript Key Up: ${event.keyCode} (${event.key})`);
                Android.logKeyEvent(event.keyCode, 'UP');
            }
        }
        
        function onInput(event) {
            console.log('Input event:', event.target.value);
            if (typeof Android !== 'undefined') {
                Android.logError(`Input event: ${event.target.value}`);
                
                // ì…ë ¥ëœ í…ìŠ¤íŠ¸ì˜ ê° ë¬¸ìì— ëŒ€í•´ í‚¤ ì´ë²¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜
                const currentValue = event.target.value;
                if (currentValue.length > 0) {
                    const lastChar = currentValue.charAt(currentValue.length - 1);
                    const keyCode = lastChar.charCodeAt(0);
                    
                    // í‚¤ ë‹¤ìš´ ì´ë²¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜
                    Android.logKeyEvent(keyCode, 'DOWN');
                    
                    // í‚¤ ì—… ì´ë²¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜ (ì•½ê°„ì˜ ì§€ì—° í›„)
                    setTimeout(() => {
                        Android.logKeyEvent(keyCode, 'UP');
                    }, 50);
                }
            }
        }
        
        function onFocus() {
            console.log('Text area focused');
            if (typeof Android !== 'undefined') {
                Android.logError('Text area focused');
            }
        }
        
        function onPaste(event) {
            console.log('Paste event:', event.clipboardData?.getData('text'));
            if (typeof Android !== 'undefined') {
                Android.logError(`Paste event: ${event.clipboardData?.getData('text')}`);
            }
        }
        
        function onCut(event) {
            console.log('Cut event');
            if (typeof Android !== 'undefined') {
                Android.logError('Cut event');
            }
        }

        function updatePatternCount() {
            document.getElementById('patternCount').textContent = 
                `íƒ€ì´í•‘ëœ í‚¤ ìˆ˜: ${keyCount}`;
        }

        function savePattern() {
            // ì•ˆë“œë¡œì´ë“œ ë„¤ì´í‹°ë¸Œ íŒ¨í„´ ì‚¬ìš©
            let pattern;
            if (typeof Android !== 'undefined') {
                pattern = Android.getAndroidTypingPattern();
                console.log('ì•ˆë“œë¡œì´ë“œ ë„¤ì´í‹°ë¸Œ íŒ¨í„´:', pattern);
                Android.logError(`ì•ˆë“œë¡œì´ë“œ ë„¤ì´í‹°ë¸Œ íŒ¨í„´: ${pattern}`);
            } else {
                pattern = tdna.getTypingPattern({type: 2}); // Extended íƒ€ì… ì‚¬ìš©
                console.log('JavaScript íŒ¨í„´:', pattern);
            }
            
            if (!pattern) {
                showResult('ë¨¼ì € í…ìŠ¤íŠ¸ë¥¼ íƒ€ì´í•‘í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const apiKey = "3a07f4dae8484fb7f70d0d0613a3a3e4";
            const apiSecret = "d97ae110a884c19f47318d54373e27d9"; // ì‹¤ì œ API Secretì„ ì…ë ¥í•˜ì„¸ìš”
            const auth = btoa(apiKey + ":" + apiSecret);

            const requestBody = {
                tp: pattern,
                user_id: userId,
                text: document.getElementById('typingArea').value || 'test_text'
            };
            
            console.log('=== íŒ¨í„´ ì €ì¥ ===');
            console.log('Current userId:', userId);
            console.log('User ID length:', userId.length);
            console.log('User ID type:', typeof userId);
            console.log('Request body:', requestBody);
            
            if (typeof Android !== 'undefined') {
                Android.logError(`íŒ¨í„´ ì €ì¥ - User ID: ${userId}, Length: ${userId.length}, Type: ${typeof userId}`);
            }
            
            fetch(`https://api.typingdna.com/auto/${userId}`, {
                method: 'POST',
                headers: {
                    'Authorization': 'Basic ' + auth,
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `tp=${pattern}&text=${encodeURIComponent(document.getElementById('typingArea').value || 'test_text')}`
            })
            .then(response => {
                console.log(`ì €ì¥ API ì‘ë‹µ: ${response.status} ${response.statusText}`);
                if (typeof Android !== 'undefined') {
                    Android.logError(`ì €ì¥ API ì‘ë‹µ: ${response.status} ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('ì €ì¥ ì‘ë‹µ ë°ì´í„°:', data);
                if (typeof Android !== 'undefined') {
                    Android.logError(`ì €ì¥ ì‘ë‹µ ë°ì´í„°: ${JSON.stringify(data)}`);
                }
                
                if (data.status === 200) {
                    showResult(`${userId}ì˜ íƒ€ì´í•‘ íŒ¨í„´ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (${data.message})`, 'success');
                    Android.onPatternSaved(userId, true);
                } else {
                    showResult(`ì €ì¥ ì‹¤íŒ¨: ${data.message}`, 'error');
                    Android.onPatternSaved(userId, false);
                }
            })
            .catch(error => {
                let errorMessage = `ì˜¤ë¥˜: ${error.message}`;
                
                // ë” êµ¬ì²´ì ì¸ ì—ëŸ¬ ì •ë³´ ì¶”ê°€
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    errorMessage = 'ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜: ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.';
                } else if (error.message.includes('CORS')) {
                    errorMessage = 'CORS ì˜¤ë¥˜: ë¸Œë¼ìš°ì € ë³´ì•ˆ ì •ì±…ìœ¼ë¡œ ì¸í•œ ì°¨ë‹¨.';
                } else if (error.message.includes('401')) {
                    errorMessage = 'ì¸ì¦ ì˜¤ë¥˜: API í‚¤ë¥¼ í™•ì¸í•˜ì„¸ìš”.';
                } else if (error.message.includes('403')) {
                    errorMessage = 'ê¶Œí•œ ì˜¤ë¥˜: API ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.';
                } else if (error.message.includes('404')) {
                    errorMessage = 'API ì—”ë“œí¬ì¸íŠ¸ ì˜¤ë¥˜: ì˜ëª»ëœ URLì…ë‹ˆë‹¤.';
                } else if (error.message.includes('500')) {
                    errorMessage = 'ì„œë²„ ì˜¤ë¥˜: TypingDNA ì„œë²„ ë¬¸ì œì…ë‹ˆë‹¤.';
                }
                
                showResult(errorMessage, 'error');
                if (typeof Android !== 'undefined') {
                    Android.logError(errorMessage);
                }
                console.error('API Error:', error);
                console.error('Error details:', {
                    name: error.name,
                    message: error.message,
                    stack: error.stack
                });
            });
        }

        function verifyPattern() {
            // ì•ˆë“œë¡œì´ë“œ ë„¤ì´í‹°ë¸Œ íŒ¨í„´ ì‚¬ìš©
            let pattern;
            if (typeof Android !== 'undefined') {
                pattern = Android.getAndroidTypingPattern();
                console.log('ì•ˆë“œë¡œì´ë“œ ë„¤ì´í‹°ë¸Œ ê²€ì¦ íŒ¨í„´:', pattern);
                Android.logError(`ì•ˆë“œë¡œì´ë“œ ë„¤ì´í‹°ë¸Œ ê²€ì¦ íŒ¨í„´: ${pattern}`);
            } else {
                pattern = tdna.getTypingPattern({type: 2}); // Extended íƒ€ì… ì‚¬ìš©
                console.log('JavaScript ê²€ì¦ íŒ¨í„´:', pattern);
            }
            
            if (!pattern) {
                showResult('ë¨¼ì € í…ìŠ¤íŠ¸ë¥¼ íƒ€ì´í•‘í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const apiKey = "3a07f4dae8484fb7f70d0d0613a3a3e4";
            const apiSecret = "d97ae110a884c19f47318d54373e27d9"; // ì‹¤ì œ API Secretì„ ì…ë ¥í•˜ì„¸ìš”
            const auth = btoa(apiKey + ":" + apiSecret);

            fetch(`https://api.typingdna.com/auto/${userId}`, {
                method: 'POST',
                headers: {
                    'Authorization': 'Basic ' + auth,
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `tp=${pattern}&text=${encodeURIComponent(document.getElementById('typingArea').value || 'test_text')}`
            })
            .then(response => {
                console.log(`ê²€ì¦ API ì‘ë‹µ: ${response.status} ${response.statusText}`);
                if (typeof Android !== 'undefined') {
                    Android.logError(`ê²€ì¦ API ì‘ë‹µ: ${response.status} ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('ê²€ì¦ ì‘ë‹µ ë°ì´í„°:', data);
                if (typeof Android !== 'undefined') {
                    Android.logError(`ê²€ì¦ ì‘ë‹µ ë°ì´í„°: ${JSON.stringify(data)}`);
                }
                
                if (data.status === 200) {
                    const score = data.score || 0;
                    const message = `ê²€ì¦ ê²°ê³¼: ${score}% ì¼ì¹˜\nì‚¬ìš©ì: ${userId}\në©”ì‹œì§€: ${data.message}`;
                    showResult(message, score > 50 ? 'success' : 'error');
                    Android.onPatternVerified(userId, score);
                } else {
                    showResult(`ê²€ì¦ ì‹¤íŒ¨: ${data.message}`, 'error');
                }
            })
            .catch(error => {
                const errorMessage = `ì˜¤ë¥˜: ${error.message}`;
                showResult(errorMessage, 'error');
                if (typeof Android !== 'undefined') {
                    Android.logError(errorMessage);
                }
                console.error('API Error:', error);
            });
        }

        function compareUsers() {
            // ì•ˆë“œë¡œì´ë“œ ë„¤ì´í‹°ë¸Œ íŒ¨í„´ ì‚¬ìš©
            let pattern;
            if (typeof Android !== 'undefined') {
                pattern = Android.getAndroidTypingPattern();
                console.log('ì•ˆë“œë¡œì´ë“œ ë„¤ì´í‹°ë¸Œ ë¹„êµ íŒ¨í„´:', pattern);
                Android.logError(`ì•ˆë“œë¡œì´ë“œ ë„¤ì´í‹°ë¸Œ ë¹„êµ íŒ¨í„´: ${pattern}`);
            } else {
                pattern = tdna.getTypingPattern({type: 2}); // Extended íƒ€ì… ì‚¬ìš©
                console.log('JavaScript ë¹„êµ íŒ¨í„´:', pattern);
            }
            
            if (!pattern) {
                showResult('ë¨¼ì € í…ìŠ¤íŠ¸ë¥¼ íƒ€ì´í•‘í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const apiKey = "3a07f4dae8484fb7f70d0d0613a3a3e4";
            const apiSecret = "d97ae110a884c19f47318d54373e27d9";
            const auth = btoa(apiKey + ":" + apiSecret);

            // ì‚¬ìš©ì Aì™€ B ëª¨ë‘ì— ëŒ€í•´ ê²€ì¦ ì‹œë„
            Promise.all([
                fetch(`https://api.typingdna.com/auto/${getUserA()}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Basic ' + auth,
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `tp=${pattern}&text=${encodeURIComponent(document.getElementById('typingArea').value || 'test_text')}`
                }).then(res => res.json()),
                fetch(`https://api.typingdna.com/auto/${getUserB()}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Basic ' + auth,
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `tp=${pattern}&text=${encodeURIComponent(document.getElementById('typingArea').value || 'test_text')}`
                }).then(res => res.json())
            ])
            .then(([userAResult, userBResult]) => {
                const scoreA = userAResult.status === 200 ? (userAResult.score || 0) : 0;
                const scoreB = userBResult.status === 200 ? (userBResult.score || 0) : 0;
                
                let message = `ì‚¬ìš©ì ë¹„êµ ê²°ê³¼:\n`;
                message += `ì‚¬ìš©ì A (${getUserA()}): ${scoreA}% ì¼ì¹˜\n`;
                message += `ì‚¬ìš©ì B (${getUserB()}): ${scoreB}% ì¼ì¹˜\n\n`;
                
                if (scoreA > scoreB && scoreA > 50) {
                    message += `ê²°ë¡ : ì‚¬ìš©ì Aë¡œ íŒë³„ë¨`;
                } else if (scoreB > scoreA && scoreB > 50) {
                    message += `ê²°ë¡ : ì‚¬ìš©ì Bë¡œ íŒë³„ë¨`;
                } else {
                    message += `ê²°ë¡ : ëª…í™•í•œ êµ¬ë¶„ ë¶ˆê°€`;
                }
                
                showResult(message, 'info');
            })
            .catch(error => {
                const errorMessage = `ë¹„êµ ì˜¤ë¥˜: ${error.message}`;
                showResult(errorMessage, 'error');
                if (typeof Android !== 'undefined') {
                    Android.logError(errorMessage);
                }
                console.error('Comparison Error:', error);
            });
        }

        function testConnection() {
            showResult('ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...', 'info');

            // 1. ê°€ì¥ ê°„ë‹¨í•œ ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸
            fetch('https://httpbin.org/get')
            .then(response => {
                if (response.ok) {
                    showResult('âœ… ê¸°ë³¸ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì„±ê³µ', 'success');
                    return response.json();
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            })
            .then(data => {
                showResult(`âœ… ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ: ${JSON.stringify(data).substring(0, 100)}...`, 'success');
                
                // 2. TypingDNA API í…ŒìŠ¤íŠ¸
                const apiKey = "3a07f4dae8484fb7f70d0d0613a3a3e4";
                const apiSecret = "d97ae110a884c19f47318d54373e27d9";
                const auth = btoa(apiKey + ":" + apiSecret);
                
                const userId = USER_A;
                return fetch(`https://api.typingdna.com/auto/${userId}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Basic ' + auth,
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `tp=test_pattern`
                });
            })
            .then(response => {
                if (response.ok) {
                    showResult('âœ… TypingDNA API ì—°ê²° ì„±ê³µ!', 'success');
                } else {
                    showResult(`âŒ TypingDNA API ì—°ê²° ì‹¤íŒ¨: ${response.status} ${response.statusText}`, 'error');
                }
            })
            .catch(error => {
                let errorMessage = `âŒ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    errorMessage = 'âŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜: ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.';
                } else if (error.message.includes('CORS')) {
                    errorMessage = 'âŒ CORS ì˜¤ë¥˜: ë¸Œë¼ìš°ì € ë³´ì•ˆ ì •ì±…ìœ¼ë¡œ ì¸í•œ ì°¨ë‹¨.';
                }
                
                showResult(errorMessage, 'error');
                if (typeof Android !== 'undefined') {
                    Android.logError(errorMessage);
                }
                console.error('Connection test error:', error);
            });
        }

        function simpleTest() {
            showResult('ê°„ë‹¨í•œ ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            // 1. ê¸°ë³¸ ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸
            fetch('https://httpbin.org/ip')
            .then(response => {
                showResult(`ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}`, 'info');
                return response.json();
            })
            .then(data => {
                showResult(`âœ… ì„±ê³µ! IP: ${data.origin}`, 'success');
                
                // 2. TypingDNA API ê¸°ë³¸ í…ŒìŠ¤íŠ¸ - ê³ ì •ëœ ê°’ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
                const apiKey = "3a07f4dae8484fb7f70d0d0613a3a3e4";
                const apiSecret = "d97ae110a884c19f47318d54373e27d9";
                const auth = btoa(apiKey + ":" + apiSecret);
                
                const testRequest = {
                    tp: 'test_pattern_123',
                    user_id: USER_A,
                    text: 'test_text'
                };
                
                console.log('=== ê°„ë‹¨ í…ŒìŠ¤íŠ¸ ===');
                console.log('Test request:', testRequest);
                console.log('User ID length:', testRequest.user_id.length);
                
                // ì‹¤ì œ TypingDNA íŒ¨í„´ ì‚¬ìš©
                const realPattern = "0,3.2,0,1,6,3255507267,0,-1,-1,0,-1,-1,0,-1,-1,11,115,112,11,29,26,1,0,0,1,2,1,4210384742,1,1,0,0,0,1,2560,1440,2,1015,138,0,2343085426|103,6167,84,71|101,48,82,69|109,100,105,77|105,110,69,73|110,83,92,78|105,79,86,73";
                
                return fetch(`https://api.typingdna.com/auto/${USER_A}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Basic ' + auth,
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `tp=${encodeURIComponent(realPattern)}&text=gemini`
                });
            })
            .then(response => {
                showResult(`TypingDNA API ì‘ë‹µ: ${response.status} ${response.statusText}`, 'info');
                return response.json();
            })
            .then(data => {
                showResult(`âœ… TypingDNA API ì„±ê³µ: ${JSON.stringify(data)}`, 'success');
                if (typeof Android !== 'undefined') {
                    Android.logError(`TypingDNA API í…ŒìŠ¤íŠ¸ ì„±ê³µ: ${JSON.stringify(data)}`);
                }
            })
            .catch(error => {
                const errorMsg = `âŒ ì‹¤íŒ¨: ${error.message}`;
                showResult(errorMsg, 'error');
                if (typeof Android !== 'undefined') {
                    Android.logError(errorMsg);
                }
                console.error('Simple test error:', error);
            });
        }

        function testApiKey() {
            showResult('API í‚¤ í…ŒìŠ¤íŠ¸ ì¤‘...', 'info');
            
            const apiKey = "3a07f4dae8484fb7f70d0d0613a3a3e4";
            const apiSecret = "d97ae110a884c19f47318d54373e27d9";
            const auth = btoa(apiKey + ":" + apiSecret);
            
            const testUserId = USER_A;
            const requestBody = {
                tp: 'test_pattern_for_key_validation',
                user_id: testUserId,
                text: 'test_text_for_key_validation'
            };
            
            console.log('=== API í‚¤ í…ŒìŠ¤íŠ¸ ===');
            console.log('User ID:', testUserId);
            console.log('User ID length:', testUserId.length);
            console.log('Request body:', requestBody);
            
            if (typeof Android !== 'undefined') {
                Android.logError(`API í‚¤ í…ŒìŠ¤íŠ¸ - User ID: ${testUserId}, Length: ${testUserId.length}`);
            }
            
            // API í‚¤ ìœ íš¨ì„± í…ŒìŠ¤íŠ¸
            // ì‹¤ì œ TypingDNA íŒ¨í„´ ì‚¬ìš©
            const realPattern = "0,3.2,0,1,6,3255507267,0,-1,-1,0,-1,-1,0,-1,-1,11,115,112,11,29,26,1,0,0,1,2,1,4210384742,1,1,0,0,0,1,2560,1440,2,1015,138,0,2343085426|103,6167,84,71|101,48,82,69|109,100,105,77|105,110,69,73|110,83,92,78|105,79,86,73";
            
            fetch(`https://api.typingdna.com/auto/${testUserId}`, {
                method: 'POST',
                headers: {
                    'Authorization': 'Basic ' + auth,
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `tp=${encodeURIComponent(realPattern)}&text=gemini`
            })
            .then(response => {
                showResult(`API ì‘ë‹µ: ${response.status} ${response.statusText}`, 'info');
                if (response.status === 401) {
                    showResult('âŒ API í‚¤ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.', 'error');
                } else if (response.status === 200 || response.status === 201) {
                    showResult('âœ… API í‚¤ê°€ ìœ íš¨í•©ë‹ˆë‹¤.', 'success');
                } else {
                    showResult(`âš ï¸ API ì‘ë‹µ: ${response.status}`, 'info');
                }
                return response.json();
            })
            .then(data => {
                showResult(`API ì‘ë‹µ ë°ì´í„°: ${JSON.stringify(data)}`, 'info');
                if (typeof Android !== 'undefined') {
                    Android.logError(`API í‚¤ í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${JSON.stringify(data)}`);
                }
            })
            .catch(error => {
                const errorMsg = `âŒ API í‚¤ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                showResult(errorMsg, 'error');
                if (typeof Android !== 'undefined') {
                    Android.logError(errorMsg);
                }
                console.error('API key test error:', error);
            });
        }

        function minimalTest() {
            showResult('ìµœì†Œ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            const apiKey = "3a07f4dae8484fb7f70d0d0613a3a3e4";
            const apiSecret = "d97ae110a884c19f47318d54373e27d9";
            const auth = btoa(apiKey + ":" + apiSecret);
            
            // ê°€ì¥ ê°„ë‹¨í•œ ìš”ì²­
            const minimalRequest = {
                tp: "test",
                user_id: USER_A,
                text: "test"
            };
            
            console.log('=== ìµœì†Œ í…ŒìŠ¤íŠ¸ ===');
            console.log('Request:', minimalRequest);
            console.log('User ID:', minimalRequest.user_id);
            console.log('User ID length:', minimalRequest.user_id.length);
            
            // ì‹¤ì œ TypingDNA íŒ¨í„´ ì‚¬ìš©
            const realPattern = "0,3.2,0,1,6,3255507267,0,-1,-1,0,-1,-1,0,-1,-1,11,115,112,11,29,26,1,0,0,1,2,1,4210384742,1,1,0,0,0,1,2560,1440,2,1015,138,0,2343085426|103,6167,84,71|101,48,82,69|109,100,105,77|105,110,69,73|110,83,92,78|105,79,86,73";
            
            fetch(`https://api.typingdna.com/auto/${USER_A}`, {
                method: 'POST',
                headers: {
                    'Authorization': 'Basic ' + auth,
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `tp=${encodeURIComponent(realPattern)}&text=gemini`
            })
            .then(response => {
                console.log('Response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Response data:', data);
                showResult(`ì‘ë‹µ: ${JSON.stringify(data)}`, 'info');
            })
            .catch(error => {
                console.error('Minimal test error:', error);
                showResult(`ì˜¤ë¥˜: ${error.message}`, 'error');
            });
        }

        function checkUser() {
            showResult('ì‚¬ìš©ì í™•ì¸ ì¤‘...', 'info');
            
            const apiKey = "3a07f4dae8484fb7f70d0d0613a3a3e4";
            const apiSecret = "d97ae110a884c19f47318d54373e27d9";
            const auth = btoa(apiKey + ":" + apiSecret);
            
            const userId = USER_A;
            
            console.log('=== ì‚¬ìš©ì í™•ì¸ í…ŒìŠ¤íŠ¸ ===');
            console.log('User ID:', userId);
            
            fetch(`https://api.typingdna.com/user/${userId}`, {
                method: 'GET',
                headers: {
                    'Authorization': 'Basic ' + auth
                }
            })
            .then(response => {
                showResult(`ì‚¬ìš©ì í™•ì¸ ì‘ë‹µ: ${response.status} ${response.statusText}`, 'info');
                return response.json();
            })
            .then(data => {
                showResult(`âœ… ì‚¬ìš©ì í™•ì¸ ì„±ê³µ: ${JSON.stringify(data)}`, 'success');
                if (typeof Android !== 'undefined') {
                    Android.logError(`ì‚¬ìš©ì í™•ì¸ ì„±ê³µ: ${JSON.stringify(data)}`);
                }
            })
            .catch(error => {
                const errorMsg = `âŒ ì‚¬ìš©ì í™•ì¸ ì‹¤íŒ¨: ${error.message}`;
                showResult(errorMsg, 'error');
                if (typeof Android !== 'undefined') {
                    Android.logError(errorMsg);
                }
                console.error('Check user error:', error);
            });
        }

        function clearText() {
            document.getElementById('typingArea').value = '';
            tdna.reset();
            isRecording = false;
            keyCount = 0;
            updatePatternCount();
            document.getElementById('result').style.display = 'none';
        }
        
        function clearPattern() {
            if (typeof Android !== 'undefined') {
                Android.clearPattern();
                const eventCount = Android.getKeyEventCount();
                showResult(`íŒ¨í„´ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.\nì´ë²¤íŠ¸ ìˆ˜: ${eventCount}\nìƒˆë¡œìš´ íƒ€ì´í•‘ì„ ì‹œì‘í•˜ì„¸ìš”.`, 'info');
            } else {
                showResult('ì•ˆë“œë¡œì´ë“œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
            }
        }
        
        function showRealTimePattern() {
            if (typeof Android !== 'undefined') {
                const eventCount = Android.getKeyEventCount();
                const pattern = Android.getAndroidTypingPattern();
                const currentText = document.getElementById('typingArea').value;
                const message = `ì‹¤ì‹œê°„ íŒ¨í„´ ì •ë³´:\nì´ë²¤íŠ¸ ìˆ˜: ${eventCount}\ní˜„ì¬ í…ìŠ¤íŠ¸: "${currentText}"\ní…ìŠ¤íŠ¸ ê¸¸ì´: ${currentText.length}\níŒ¨í„´: ${pattern}`;
                showResult(message, 'info');
                
                // íŒ¨í„´ì„ íŒŒì¼ì— ì €ì¥
                Android.savePatternToFile(pattern, eventCount, currentText);
            } else {
                showResult('ì•ˆë“œë¡œì´ë“œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
            }
        }
        
        function startRecording() {
            if (typeof Android !== 'undefined') {
                Android.startAndroidRecording();
                showResult('ì•ˆë“œë¡œì´ë“œ ë…¹í™”ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. í‚¤ë³´ë“œ ì´ë²¤íŠ¸ë¥¼ ìº¡ì²˜í•©ë‹ˆë‹¤.', 'info');
            } else {
                showResult('ì•ˆë“œë¡œì´ë“œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
            }
        }
        
        function verifyUser() {
            if (typeof Android !== 'undefined') {
                const pattern = Android.getAndroidTypingPattern();
                const currentText = document.getElementById('typingArea').value;
                
                if (currentText.length < 5) {
                    showResult('ìµœì†Œ 5ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                    return;
                }
                
                showResult('ìœ ì € ê²€ì¦ ì¤‘...', 'info');
                
                // ì‚¬ìš©ì Aì™€ Bì— ëŒ€í•´ ê°ê° ê²€ì¦
                Promise.all([
                    verifyAgainstUser(USER_A, pattern, currentText, 'A'),
                    verifyAgainstUser(USER_B, pattern, currentText, 'B')
                ]).then(results => {
                    const [scoreA, scoreB] = results;
                    
                    // í™•ë¥  ê³„ì‚° (ì ìˆ˜ê°€ ë†’ì„ìˆ˜ë¡ ë” ìœ ì‚¬í•¨)
                    const totalScore = scoreA + scoreB;
                    const probabilityA = totalScore > 0 ? (scoreA / totalScore * 100).toFixed(1) : 50;
                    const probabilityB = totalScore > 0 ? (scoreB / totalScore * 100).toFixed(1) : 50;
                    
                    // ê²°ë¡  ë„ì¶œ
                    let conclusion = '';
                    if (scoreA > scoreB) {
                        conclusion = `ê²°ë¡ : ì‚¬ìš©ì Aë¡œ í™•ì •! (${probabilityA}% í™•ë¥ )`;
                    } else if (scoreB > scoreA) {
                        conclusion = `ê²°ë¡ : ì‚¬ìš©ì Bë¡œ í™•ì •! (${probabilityB}% í™•ë¥ )`;
                    } else {
                        conclusion = 'ê²°ë¡ : êµ¬ë¶„ ë¶ˆê°€ (ë™ì )';
                    }
                    
                    const resultMessage = `ğŸ” ìœ ì € ê²€ì¦ ê²°ê³¼

ğŸ“Š ì ìˆ˜:
- ì‚¬ìš©ì A: ${scoreA}ì 
- ì‚¬ìš©ì B: ${scoreB}ì 

ğŸ“ˆ í™•ë¥ :
- ì‚¬ìš©ì A: ${probabilityA}%
- ì‚¬ìš©ì B: ${probabilityB}%

ğŸ¯ ${conclusion}`;
                    
                    showResult(resultMessage, scoreA > scoreB || scoreB > scoreA ? 'success' : 'info');
                }).catch(error => {
                    showResult(`ìœ ì € ê²€ì¦ ì‹¤íŒ¨: ${error.message}`, 'error');
                });
                
            } else {
                showResult('ì•ˆë“œë¡œì´ë“œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
            }
        }
        
        function verifyAgainstUser(userId, pattern, text, userLabel) {
            return new Promise((resolve, reject) => {
                const apiKey = "3a07f4dae8484fb7f70d0d0613a3a3e4";
                const apiSecret = "d97ae110a884c19f47318d54373e27d9";
                const auth = btoa(apiKey + ":" + apiSecret);
                
                const formData = new URLSearchParams();
                formData.append('tp', pattern);
                formData.append('text', text);
                
                fetch(`https://api.typingdna.com/verify/${userId}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Basic ' + auth,
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    console.log(`ì‚¬ìš©ì ${userLabel} ê²€ì¦ ê²°ê³¼:`, data);
                    if (typeof Android !== 'undefined') {
                        Android.logError(`ì‚¬ìš©ì ${userLabel} ê²€ì¦ ê²°ê³¼: ${JSON.stringify(data)}`);
                    }
                    
                    // TypingDNA API ì‘ë‹µì—ì„œ ì ìˆ˜ ì¶”ì¶œ
                    const score = data.score || data.result || 0;
                    resolve(score);
                })
                .catch(error => {
                    console.error(`ì‚¬ìš©ì ${userLabel} ê²€ì¦ ì˜¤ë¥˜:`, error);
                    if (typeof Android !== 'undefined') {
                        Android.logError(`ì‚¬ìš©ì ${userLabel} ê²€ì¦ ì˜¤ë¥˜: ${error.message}`);
                    }
                    reject(error);
                });
            });
        }

        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = message;
            resultDiv.className = `result ${type}`;
            resultDiv.style.display = 'block';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            setUserId(userId);
            
            // í…ìŠ¤íŠ¸ ì˜ì—­ì— í¬ì»¤ìŠ¤ ì„¤ì •
            const typingArea = document.getElementById('typingArea');
            if (typingArea) {
                typingArea.focus();
            }
            
            // ì•ˆë“œë¡œì´ë“œ í™˜ê²½ì—ì„œ ë…¹í™” ì‹œì‘
            if (typeof Android !== 'undefined') {
                Android.startAndroidRecording();
            }
        };
    </script>
</body>
</html>
